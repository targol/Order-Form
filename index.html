<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>فرم سفارش ماگ</title>
  <style>
    body { font-family: sans-serif; direction: rtl; margin: 40px; background: #f9f9f9; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    input[type="number"] { width: 60px; }
    tfoot td { font-weight: bold; background: #eee; }
    label { display: block; margin: 10px 0; }
    input[type="text"], input[type="tel"] { padding: 5px; width: 250px; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 15px; cursor: pointer; }
  </style>
</head>
<body>

<h2>فرم سفارش ماگ</h2>

<table id="orderTable">
  <thead>
    <tr>
      <th>نام محصول</th>
      <th>قیمت (تومان)</th>
      <th>تعداد</th>
      <th>جمع کل هر ردیف</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ماگ شیار دار - آبی</td>
      <td>125000</td>
      <td><input type="number" min="0" oninput="updateRow(this)"></td>
      <td class="totalCell">0</td>
    </tr>
    <tr>
      <td>ماگ شیار دار - زرد</td>
      <td>125000</td>
      <td><input type="number" min="0" oninput="updateRow(this)"></td>
      <td class="totalCell">0</td>
    </tr>
    <tr>
      <td>ماگ شیار دار - قرمز</td>
      <td>125000</td>
      <td><input type="number" min="0" oninput="updateRow(this)"></td>
      <td class="totalCell">0</td>
    </tr>
    <tr>
      <td>ماگ لاستر - زرشکی</td>
      <td>175000</td>
      <td><input type="number" min="0" oninput="updateRow(this)"></td>
      <td class="totalCell">0</td>
    </tr>
    <tr>
      <td>ماگ لاستر - سورمه‌ای</td>
      <td>175000</td>
      <td><input type="number" min="0" oninput="updateRow(this)"></td>
      <td class="totalCell">0</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="3">جمع کل نهایی:</td>
      <td id="grandTotal">0</td>
    </tr>
  </tfoot>
</table>

<h3>اطلاعات مشتری</h3>
<label>نام و نام خانوادگی: <input id="customerName" type="text" required></label>
<label>شماره تماس: <input id="customerPhone" type="tel" required></label>

<button onclick="submitOrder()">ارسال سفارش</button>
<p id="statusMsg"></p>

<script>
  function updateRow(input) {
    const row = input.closest('tr');
    const price = parseInt(row.children[1].textContent);
    const qty = parseInt(input.value) || 0;
    const total = price * qty;
    row.querySelector('.totalCell').textContent = total.toLocaleString();
    updateGrandTotal();
  }

  function updateGrandTotal() {
    const totalCells = document.querySelectorAll('.totalCell');
    let grandTotal = 0;
    totalCells.forEach(cell => {
      grandTotal += parseInt(cell.textContent.replace(/,/g, '')) || 0;
    });
    document.getElementById('grandTotal').textContent = grandTotal.toLocaleString();
  }

  function submitOrder() {
    const name = document.getElementById("customerName").value.trim();
    const phone = document.getElementById("customerPhone").value.trim();

    if (!name || !phone) {
      alert("لطفاً نام و شماره تماس را وارد کنید.");
      return;
    }

    const rows = document.querySelectorAll("#orderTable tbody tr");
    let productList = [];
    let total = 0;

    rows.forEach(row => {
      const product = row.children[0].textContent;
      const price = parseInt(row.children[1].textContent);
      const qty = parseInt(row.querySelector("input").value) || 0;
      if (qty > 0) {
        const rowTotal = price * qty;
        productList.push(`${product} × ${qty} = ${rowTotal.toLocaleString()} تومان`);
        total += rowTotal;
      }
    });

    const data = {
      name: name,
      phone: phone,
      productList: productList.join("\n"),
      total: total
    };

    fetch("https://script.google.com/macros/s/AKfycbylL9dfPbQwA0vILI1IJwDtE5RE75pHR7qutYW75dXDJ4ts2k7Kpzi_SWBdc_SG1Rw/exec", {
      method: "POST",
      body: JSON.stringify(data),
    }).then(res => {
      if (res.ok) {
        alert("✅ سفارش شما با موفقیت ثبت شد!");
        document.querySelector("form")?.reset();
      } else {
        alert("❌ خطا در ثبت سفارش. لطفاً دوباره تلاش کنید.");
      }
    }).catch(err => {
      alert("⚠️ اتصال برقرار نشد: " + err);
    });
  }
</script>

</body>
</html>
